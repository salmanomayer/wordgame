module.exports=[56635,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(67301),f=a.i(14727),g=a.i(88237),h=a.i(3130),i=a.i(40695),j=a.i(5522),k=a.i(17171),l=a.i(81560),m=a.i(70106);let n=(0,m.default)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),o=(0,m.default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),p=(0,m.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),q=(0,m.default)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var r=a.i(9941),s=a.i(95490),t=a.i(85668),u=a.i(87532),v=a.i(13749),w=a.i(50522),x=a.i(18341),y=a.i(31746),z=a.i(65733),A=a.i(87682),B=a.i(1549);function C(){let[a,m]=(0,c.useState)([]),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(1),[I,J]=(0,c.useState)("20"),[K,L]=(0,c.useState)(0),[M,N]=(0,c.useState)("created_at"),[O,P]=(0,c.useState)("desc"),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(""),[aa,ab]=(0,c.useState)(!1),ac=(0,d.useRouter)(),ad=(0,c.useCallback)(async(a,b,c,d,e)=>{let f=localStorage.getItem("admin_token");if(!f)return void ac.push("/admin/login");let g=new URLSearchParams,h=a.trim();h&&g.set("q",h),g.set("page",b.toString()),g.set("limit",c),g.set("sort_by",d),g.set("sort_order",e);try{let a=await fetch(`/api/admin/players?${g.toString()}`,{headers:{Authorization:`Bearer ${f}`}});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to fetch players")}let b=await a.json();m(Array.isArray(b.data)?b.data:[]),L(b.total||0)}catch(a){console.error("[v0] Error fetching players:",a),m([]),L(0)}finally{D(!1)}},[ac]);(0,c.useEffect)(()=>{if(!localStorage.getItem("admin_token"))return void ac.push("/admin/login");D(!0);let a=setTimeout(()=>{ad(E,G,I,M,O)},250);return()=>clearTimeout(a)},[ac,ad,E,G,I,M,O]);let ae=a=>{M===a?P("asc"===O?"desc":"asc"):(N(a),P("asc")),H(1)},af=async a=>{V(a),T(!0),Z(!0);let b=localStorage.getItem("admin_token");try{let c=await fetch(`/api/admin/players/${a.id}/logs`,{headers:{Authorization:`Bearer ${b}`}});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||"Failed to fetch logs")}let d=await c.json();X(Array.isArray(d)?d:[])}catch(a){console.error("[v0] Error fetching player logs:",a),X([])}finally{Z(!1)}},ag=async b=>{if(!confirm("Are you sure you want to delete this player?"))return;let c=localStorage.getItem("admin_token");try{if(!(await fetch(`/api/admin/players/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${c}`}})).ok)throw Error("Failed to delete player");m(a.filter(a=>a.id!==b))}catch(a){console.error("[v0] Error deleting player:",a),alert("Failed to delete player")}},ah=async(b,c)=>{let d=localStorage.getItem("admin_token");try{if(!(await fetch(`/api/admin/players/${b}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({is_active:!c})})).ok)throw Error("Failed to update player status");m(a.map(a=>a.id===b?{...a,is_active:!c}:a))}catch(a){console.error("[v0] Error updating player status:",a),alert("Failed to update player status")}},ai=async()=>{if(!U||!$)return;if($.length<6)return void alert("Password must be at least 6 characters");ab(!0);let a=localStorage.getItem("admin_token");try{let b=await fetch(`/api/admin/players/${U.id}/password`,{method:"PATCH",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({password:$})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to update password")}alert("Password updated successfully"),R(!1),_(""),V(null)}catch(a){console.error("[v0] Error updating password:",a),alert(a.message||"Failed to update password")}finally{ab(!1)}},aj=async b=>{let c=localStorage.getItem("admin_token");try{let d=await fetch(`/api/admin/players/${b}/activate`,{method:"PATCH",headers:{Authorization:`Bearer ${c}`}});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to activate user")}m(a.map(a=>a.id===b?{...a,is_active:!0}:a)),alert("User activated successfully")}catch(a){console.error("[v0] Error activating user:",a),alert(a.message||"Failed to activate user")}};return C?(0,b.jsxs)(f.SidebarProvider,{children:[(0,b.jsx)(e.AdminNav,{}),(0,b.jsxs)(f.SidebarInset,{className:"bg-muted/40",children:[(0,b.jsxs)("header",{className:"flex h-16 items-center gap-2 border-b bg-background px-4",children:[(0,b.jsx)(f.SidebarTrigger,{}),(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Players"})]}),(0,b.jsx)("div",{className:"flex min-h-[calc(100svh-4rem)] items-center justify-center",children:(0,b.jsx)("div",{className:"text-lg",children:"Loading..."})})]})]}):(0,b.jsxs)(f.SidebarProvider,{children:[(0,b.jsx)(e.AdminNav,{}),(0,b.jsxs)(f.SidebarInset,{className:"min-w-0 bg-muted/40",children:[(0,b.jsxs)("header",{className:"flex h-16 items-center gap-2 border-b bg-background px-4",children:[(0,b.jsx)(f.SidebarTrigger,{}),(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Players"})]}),(0,b.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,b.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-4 flex-1 min-w-[240px] max-w-md",children:(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsx)(u.Search,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"Search players...",value:E,onChange:a=>{F(a.target.value),H(1)},className:"pl-8"})]})}),(0,b.jsxs)(i.Button,{onClick:()=>{if(!Array.isArray(a)||0===a.length)return void alert("No players data available to export");let b=new Blob([["Name,Email,Phone,Total Score,Games Played,Joined,Status",...a.map(a=>[`"${a.display_name||"N/A"}"`,`"${a.email||"N/A"}"`,`"${a.phone_number||"N/A"}"`,a.total_score,a.games_played,new Date(a.created_at).toLocaleDateString(),a.is_active?"Active":"Disabled"].join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),d=URL.createObjectURL(b);c.setAttribute("href",d),c.setAttribute("download",`players_${new Date().toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},variant:"outline",className:"w-full sm:w-auto gap-2 bg-transparent shrink-0",children:[(0,b.jsx)(p,{className:"h-4 w-4"}),"Export Excel"]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{children:["Player List (",K,")"]})}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"w-full overflow-x-auto rounded-md border",children:(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHeader,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("display_name"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Name","display_name"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("email"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Email","email"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("phone_number"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Phone","phone_number"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("total_score"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Total Score","total_score"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("games_played"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Games Played","games_played"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("created_at"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Joined","created_at"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"cursor-pointer select-none whitespace-nowrap",onClick:()=>ae("is_active"),children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["Status","is_active"===M?"asc"===O?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4"}):(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-muted-foreground/50"})]})}),(0,b.jsx)(g.TableHead,{className:"text-right whitespace-nowrap",children:"Actions"})]})}),(0,b.jsx)(g.TableBody,{children:0===a.length?(0,b.jsx)(g.TableRow,{children:(0,b.jsx)(g.TableCell,{colSpan:8,className:"text-center",children:"No players found"})}):a.map(a=>(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableCell,{className:"whitespace-nowrap",children:a.display_name||"N/A"}),(0,b.jsx)(g.TableCell,{className:"text-sm text-muted-foreground whitespace-nowrap",children:a.email||"N/A"}),(0,b.jsx)(g.TableCell,{className:"whitespace-nowrap",children:a.phone_number||"N/A"}),(0,b.jsx)(g.TableCell,{className:"whitespace-nowrap",children:a.total_score}),(0,b.jsx)(g.TableCell,{className:"whitespace-nowrap",children:a.games_played}),(0,b.jsx)(g.TableCell,{className:"whitespace-nowrap",children:new Date(a.created_at).toLocaleDateString()}),(0,b.jsx)(g.TableCell,{className:"whitespace-nowrap",children:(0,b.jsx)(i.Button,{variant:a.is_active?"default":"secondary",size:"sm",onClick:()=>ah(a.id,a.is_active),children:a.is_active?"Active":"Disabled"})}),(0,b.jsxs)(g.TableCell,{className:"text-right space-x-2 whitespace-nowrap",children:[(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>af(a),title:"View Logs",children:(0,b.jsx)(q,{className:"h-4 w-4"})}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{V(a),R(!0)},title:"Set Password",children:(0,b.jsx)(n,{className:"h-4 w-4"})}),!a.is_active&&(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>aj(a.id),title:"Activate User",className:"text-green-600 hover:text-green-700",children:(0,b.jsx)(o,{className:"h-4 w-4"})}),(0,b.jsx)(i.Button,{variant:"destructive",size:"sm",onClick:()=>ag(a.id),children:(0,b.jsx)(l.Trash2,{className:"h-4 w-4"})})]})]},a.id))})]})}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 py-4 mt-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium whitespace-nowrap",children:"Rows per page"}),(0,b.jsxs)(A.Select,{value:I,onValueChange:a=>{J(a),H(1)},children:[(0,b.jsx)(A.SelectTrigger,{className:"h-8 w-[70px]",children:(0,b.jsx)(A.SelectValue,{placeholder:I})}),(0,b.jsx)(A.SelectContent,{side:"top",children:["20","50","100","all"].map(a=>(0,b.jsx)(A.SelectItem,{value:a,children:"all"===a?"All":a},a))})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",G," of ","all"===I?1:Math.ceil(K/parseInt(I))||1]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)(i.Button,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>H(1),disabled:1===G,children:[(0,b.jsx)("span",{className:"sr-only",children:"Go to first page"}),(0,b.jsx)(x.ChevronsLeft,{className:"h-4 w-4"})]}),(0,b.jsxs)(i.Button,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>H(G-1),disabled:1===G,children:[(0,b.jsx)("span",{className:"sr-only",children:"Go to previous page"}),(0,b.jsx)(v.ChevronLeft,{className:"h-4 w-4"})]}),(0,b.jsxs)(i.Button,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>H(G+1),disabled:"all"===I||G>=Math.ceil(K/parseInt(I)),children:[(0,b.jsx)("span",{className:"sr-only",children:"Go to next page"}),(0,b.jsx)(w.ChevronRight,{className:"h-4 w-4"})]}),(0,b.jsxs)(i.Button,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>H(Math.ceil(K/parseInt(I))),disabled:"all"===I||G>=Math.ceil(K/parseInt(I)),children:[(0,b.jsx)("span",{className:"sr-only",children:"Go to last page"}),(0,b.jsx)(y.ChevronsRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,b.jsx)(z.Dialog,{open:Q,onOpenChange:R,children:(0,b.jsxs)(z.DialogContent,{children:[(0,b.jsxs)(z.DialogHeader,{children:[(0,b.jsxs)(z.DialogTitle,{children:["Set Password for ",U?.display_name||"Player"]}),(0,b.jsx)(z.DialogDescription,{children:"Enter a new password for this user. The password must be at least 6 characters."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(k.Label,{htmlFor:"newPassword",children:"New Password"}),(0,b.jsx)(j.Input,{id:"newPassword",type:"password",value:$,onChange:a=>_(a.target.value),placeholder:"Enter new password"})]}),(0,b.jsx)(i.Button,{onClick:ai,disabled:aa||!$,className:"w-full",children:aa?"Updating...":"Set Password"})]})]})}),(0,b.jsx)(z.Dialog,{open:S,onOpenChange:T,children:(0,b.jsxs)(z.DialogContent,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,b.jsxs)(z.DialogHeader,{children:[(0,b.jsxs)(z.DialogTitle,{children:["Activity Logs - ",U?.display_name||"Player"]}),(0,b.jsx)(z.DialogDescription,{children:"Device, browser, and location information for this player."})]}),(0,b.jsx)("div",{className:"py-4",children:Y?(0,b.jsx)("div",{className:"text-center py-8",children:"Loading logs..."}):0===W.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No logs found for this player."}):(0,b.jsx)("div",{className:"rounded-md border overflow-x-auto",children:(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHeader,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHead,{children:"Date"}),(0,b.jsx)(g.TableHead,{children:"Action"}),(0,b.jsx)(g.TableHead,{children:"IP Address"}),(0,b.jsx)(g.TableHead,{children:"Browser"}),(0,b.jsx)(g.TableHead,{children:"Device"}),(0,b.jsx)(g.TableHead,{children:"Location"})]})}),(0,b.jsx)(g.TableBody,{children:W.map(a=>(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableCell,{className:"text-sm",children:new Date(a.created_at).toLocaleString()}),(0,b.jsx)(g.TableCell,{className:"capitalize",children:a.action}),(0,b.jsx)(g.TableCell,{className:"text-sm font-mono",children:a.ip_address||"N/A"}),(0,b.jsx)(g.TableCell,{className:"text-sm",children:a.browser||"N/A"}),(0,b.jsxs)(g.TableCell,{className:"text-sm",children:[a.device||"N/A"," ",a.os?`(${a.os})`:""]}),(0,b.jsx)(g.TableCell,{className:"text-sm",children:a.city&&a.country?`${a.city}, ${a.country}`:"N/A"})]},a.id))})]})})})]})}),(0,b.jsx)(B.AdminFooter,{})]})]})]})}a.s(["default",()=>C],56635)}];

//# sourceMappingURL=app_admin_players_page_tsx_69da91e6._.js.map