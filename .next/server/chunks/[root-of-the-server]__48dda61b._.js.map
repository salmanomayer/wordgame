{"version":3,"sources":["../../../lib/postgres.ts","../../../lib/supabase/server.ts"],"sourcesContent":["import { Pool } from \"pg\"\n\nlet pool: Pool\n\nexport function getPgPool(): Pool {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL || process.env.POSTGRES_URL_NON_POOLING,\n    })\n  }\n  return pool\n}\n\nexport async function query(text: string, params?: any[]) {\n  const client = await getPgPool().connect()\n  try {\n    const res = await client.query(text, params)\n    return res\n  } finally {\n    client.release()\n  }\n}\n\nexport async function transaction<T>(callback: (client: any) => Promise<T>): Promise<T> {\n  const client = await getPgPool().connect()\n  try {\n    await client.query(\"BEGIN\")\n    const result = await callback(client)\n    await client.query(\"COMMIT\")\n    return result\n  } catch (error) {\n    await client.query(\"ROLLBACK\")\n    throw error\n  } finally {\n    client.release()\n  }\n}\n","import { query } from \"../postgres\"\n\nexport type DbQueryResult<T = any> = {\n  rows: T[]\n  error: unknown | null\n}\n\nexport const db = {\n  query: async <T = any>(text: string, params?: any[]): Promise<DbQueryResult<T>> => {\n    try {\n      const res = await query(text, params)\n      return { rows: (res?.rows ?? []) as T[], error: null }\n    } catch (error) {\n      return { rows: [], error }\n    }\n  },\n}\n"],"names":[],"mappings":"ilCAEI,EAFJ,IAAA,EAAA,EAAA,CAAA,CAAA,gBAIO,SAAS,IAMd,OALI,AAAC,GACH,GADS,AACF,IAAI,EAAA,IAAI,CAAC,CACd,iBAAkB,QAAQ,GAAG,CAAC,YAAY,EAAI,QAAQ,GAAG,CAAC,YAAY,EAAI,QAAQ,GAAG,CAAC,wBAAwB,AAChH,EAAA,EAEK,CACT,CAEO,eAAe,EAAM,CAAY,CAAE,CAAc,EACtD,IAAM,EAAS,MAAM,IAAY,OAAO,GACxC,GAAI,CAEF,OADY,AACL,MADW,EAAO,KAAK,CAAC,EAAM,EAEvC,QAAU,CACR,EAAO,OAAO,EAChB,CACF,CAEO,eAAe,EAAe,CAAqC,EACxE,IAAM,EAAS,MAAM,IAAY,OAAO,GACxC,GAAI,CACF,MAAM,EAAO,KAAK,CAAC,SACnB,IAAM,EAAS,MAAM,EAAS,GAE9B,OADA,MAAM,EAAO,KAAK,CAAC,UACZ,CACT,CAAE,MAAO,EAAO,CAEd,MADA,MAAM,EAAO,KAAK,CAAC,YACb,CACR,QAAU,CACR,EAAO,OAAO,EAChB,CACF,8SCpCA,IAAA,EAAA,EAAA,CAAA,CAAA,qDAOkB,CAChB,MAAO,MAAgB,EAAc,KACnC,GAAI,CACF,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,EAAM,GAC9B,MAAO,CAAE,KAAO,GAAK,MAAQ,EAAE,CAAU,MAAO,IAAK,CACvD,CAAE,MAAO,EAAO,CACd,MAAO,CAAE,KAAM,EAAE,OAAE,CAAM,CAC3B,CACF,CACF"}