{"version":3,"sources":["../../../lib/postgres.ts","../../../lib/supabase/server.ts"],"sourcesContent":["import { Pool } from \"pg\"\r\n\r\nlet pool: Pool\r\n\r\nexport function getPgPool(): Pool {\r\n  if (!pool) {\r\n    pool = new Pool({\r\n      connectionString: process.env.DATABASE_URL || process.env.POSTGRES_URL || process.env.POSTGRES_URL_NON_POOLING,\r\n    })\r\n  }\r\n  return pool\r\n}\r\n\r\nexport async function query(text: string, params?: any[]) {\r\n  const client = await getPgPool().connect()\r\n  try {\r\n    const res = await client.query(text, params)\r\n    return res\r\n  } finally {\r\n    client.release()\r\n  }\r\n}\r\n\r\nexport async function transaction<T>(callback: (client: any) => Promise<T>): Promise<T> {\r\n  const client = await getPgPool().connect()\r\n  try {\r\n    await client.query(\"BEGIN\")\r\n    const result = await callback(client)\r\n    await client.query(\"COMMIT\")\r\n    return result\r\n  } catch (error) {\r\n    await client.query(\"ROLLBACK\")\r\n    throw error\r\n  } finally {\r\n    client.release()\r\n  }\r\n}\r\n","import { query } from \"../postgres\"\r\n\r\nexport type DbQueryResult<T = any> = {\r\n  rows: T[]\r\n  error: unknown | null\r\n}\r\n\r\nexport const db = {\r\n  query: async <T = any>(text: string, params?: any[]): Promise<DbQueryResult<T>> => {\r\n    try {\r\n      const res = await query(text, params)\r\n      return { rows: (res?.rows ?? []) as T[], error: null }\r\n    } catch (error) {\r\n      return { rows: [], error }\r\n    }\r\n  },\r\n}\r\n"],"names":[],"mappings":"ilCAEI,EAFJ,IAAA,EAAA,EAAA,CAAA,CAAA,gBAIO,SAAS,IAMd,OALI,AAAC,GACH,GADS,AACF,IAAI,EAAA,IAAI,CAAC,CACd,iBAAkB,QAAQ,GAAG,CAAC,YAAY,EAAI,QAAQ,GAAG,CAAC,YAAY,EAAI,QAAQ,GAAG,CAAC,wBAAwB,AAChH,EAAA,EAEK,CACT,CAEO,eAAe,EAAM,CAAY,CAAE,CAAc,EACtD,IAAM,EAAS,MAAM,IAAY,OAAO,GACxC,GAAI,CAEF,OADY,AACL,MADW,EAAO,KAAK,CAAC,EAAM,EAEvC,QAAU,CACR,EAAO,OAAO,EAChB,CACF,CAEO,eAAe,EAAe,CAAqC,EACxE,IAAM,EAAS,MAAM,IAAY,OAAO,GACxC,GAAI,CACF,MAAM,EAAO,KAAK,CAAC,SACnB,IAAM,EAAS,MAAM,EAAS,GAE9B,OADA,MAAM,EAAO,KAAK,CAAC,UACZ,CACT,CAAE,MAAO,EAAO,CAEd,MADA,MAAM,EAAO,KAAK,CAAC,YACb,CACR,QAAU,CACR,EAAO,OAAO,EAChB,CACF,8SCpCA,IAAA,EAAA,EAAA,CAAA,CAAA,qDAOkB,CAChB,MAAO,MAAgB,EAAc,KACnC,GAAI,CACF,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,EAAM,GAC9B,MAAO,CAAE,KAAO,GAAK,MAAQ,EAAE,CAAU,MAAO,IAAK,CACvD,CAAE,MAAO,EAAO,CACd,MAAO,CAAE,KAAM,EAAE,OAAE,CAAM,CAC3B,CACF,CACF"}